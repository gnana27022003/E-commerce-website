<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - Flipkart</title>
    
    <!-- Link to shared homepage CSS for header/footer -->
    <link rel="stylesheet" href="/homepage.css">
    <!-- Link to cart-specific CSS -->
    <link rel="stylesheet" href="/cart.css">
    <link rel="stylesheet" href="/homepage.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <!-- ================= HEADER ================= -->
    <%- include('header') %>
    <!-- ================= CART PAGE ================= -->
    <section class="cart-main">
        <div class="cart-container">
            
            <!-- Left Section: Cart Items -->
            <div class="cart-items-section">
                
               

                <!-- Cart Items -->
                <div class="cart-items-list" id="cartItemsList">
                    <% if (cartItems.length === 0) { %>
                        <div class="place-order-section" >
                            <div class="empty-state" align="center">
                            <i class="fa-solid fa-cart-shopping"></i>
                            <h2>your cart is empty</h2>
                        </div>

                        </div>
                    <% } else { %>
                        <% cartItems.forEach((item, index) => { %>
                            <div class="cart-item-card">
                                <img src="/uploads/products/<%= item.image %>" alt="<%= item.name %>" class="cart-item-image">
                                <div class="cart-item-info">
                                    <h4 class="cart-item-name"><%= item.name %></h4>
                                    <p class="cart-item-price">‚Çπ<%= item.price %></p>
                                    <p class="cart-item-quantity">Qty: <%= item.quantity %></p>
                                    <div class="cart-item-actions">
                                        
                                        <button class="btn-view-product" onclick="window.location.href='/product/<%= item.productId %>'">
                                            View Product
                                        </button>
                                        <button class="btn-remove-item" onclick="removeItem('<%= item.productId %>', this)">
                                            Remove
                                        </button>

                                    </div>
                                </div>
                            </div>
                        <% }) %>
                    <% } %>

                </div>


                <!-- Place Order Button -->
                
            </div>

            <!-- Right Section: Price Details -->
            <div class="price-details-section">
                <div class="price-card">
                    <h3>PRICE DETAILS</h3>
                    
                    <div class="price-row">
                        <span>Price (<span id="itemCount">0</span> item<span id="itemPlural">s</span>)</span>
                        <span id="totalPrice">‚Çπ0</span>
                    </div>
                    
                    <div class="price-row">
                        <span>Discount</span>
                        <span class="discount-amount" id="totalDiscount">‚àí‚Çπ0</span>
                    </div>
                    
                    <div class="price-row">
                        <span>Platform Fee</span>
                        <span id="platformFee">‚Çπ7</span>
                    </div>
                    
                    <div class="price-row total-row">
                        <strong>Total Amount</strong>
                        <strong id="totalAmount">‚Çπ0</strong>
                    </div>
                    
                    <div class="savings-message" id="savingsMessage">
                        You will save ‚Çπ0 on this order
                    </div>
                </div>

                <div class="secure-badge">
                    <span>üõ°Ô∏è</span>
                    <div>
                        <strong>Safe and Secure Payments.</strong>
                        <span>Easy returns.100% Authentic products.</span>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- ================= FOOTER ================= -->
    <footer class="flipkart-footer">
        <div class="footer-container">
            <div class="footer-column">
                <h4>ABOUT</h4>
                <ul>
                    <li><a href="#">Contact Us</a></li>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Careers</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>HELP</h4>
                <ul>
                    <li><a href="#">Payments</a></li>
                    <li><a href="#">Shipping</a></li>
                    <li><a href="#">FAQ</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>POLICY</h4>
                <ul>
                    <li><a href="#">Return Policy</a></li>
                    <li><a href="#">Terms Of Use</a></li>
                    <li><a href="#">Privacy</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>SOCIAL</h4>
                <ul>
                    <li><a href="#">Facebook</a></li>
                    <li><a href="#">Twitter</a></li>
                    <li><a href="#">YouTube</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>¬© 2026 E-Commerce Platform</p>
        </div>
    </footer>

    <!-- Link to JavaScript -->
    <script src="/cart.js"></script>
    <script>
        async function removeItem(index) {
        const item = cartItems[index];

        try {
            const res = await fetch(`/cart/${item.productId}`, {
                method: 'DELETE'
            });
            const result = await res.json();

            if (result.success) {
                // Remove from front-end array
                cartItems.splice(index, 1);

                // Remove element from DOM
                const cartItemsList = document.getElementById("cartItemsList");
                const itemCards = cartItemsList.querySelectorAll(".cart-item-card");
                if(itemCards[index]) itemCards[index].remove();

                // Update totals
                updatePriceDetails();

                if (cartItems.length === 0) {
                    cartItemsList.innerHTML = `<p class="empty-cart">Your cart is empty</p>`;
                }
            } else {
                alert(result.message || "Failed to remove item");
            }
        } catch (err) {
            console.error(err);
            alert("Error removing item");
        }
    }
    async function removeItem(productId, btn) {
    try {
        const res = await fetch(`/cart/${productId}`, {
            method: "DELETE"
        });

        const result = await res.json();

        if (!result.success) {
            alert("Failed to remove item");
            return;
        }

        // remove item card from DOM
        const card = btn.closest(".cart-item-card");
        card.remove();

        // OPTIONAL: if no items left
        if (document.querySelectorAll(".cart-item-card").length === 0) {
            document.getElementById("cartItemsList").innerHTML =
                `<p class="empty-cart">Your cart is empty</p>`;
        }

    } catch (err) {
        console.error(err);
        alert("Error deleting item");
    }
}

    </script>
</body>
</html>