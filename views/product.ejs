<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - E-commerce</title>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      crossorigin="anonymous"
    />

    <!-- Shared Homepage CSS -->
    <link rel="stylesheet" href="/homepage.css">

    <!-- Product Page CSS -->
    <link rel="stylesheet" href="/product.css">
</head>

<body>
    <!-- ================= HEADER ================= -->
<header class="flipkart-header">
    <div class="header-container">

        <!-- LOGO -->
        <div class="logo-section">
            <a href="/">
                <img src="/logo.png" class="logo-img" alt="logo">
            </a>
        </div>

        <!-- RIGHT ICONS -->
        <div class="nav-actions">
            <a href="home.html" class="nav-item">
                <i class="fa-solid fa-house"></i>
                <span>Home</span>
            </a>

            <a href="login.html" class="nav-item">
                <i class="fa-regular fa-user"></i>
                <span>Login</span>
            </a>

            <a href="orders.html" class="nav-item">
                <i class="fa-solid fa-box"></i>
                <span>Orders</span>
            </a>

            <a href="checkout.html" class="nav-item">
                <i class="fa-solid fa-cart-shopping"></i>
                <span>Cart</span>
            </a>

        </div>

    </div>
</header>


    <!-- ================= PAGE WRAPPER ================= -->
    <section class="product-main">

        <!-- Product Details -->
       <div class="product-container">

  <!-- LEFT COLUMN -->
  <div class="product-images">
    <% if (product.productImages && product.productImages.length > 0) { %>
      <img 
        src="/uploads/products/<%= product.productImages[0].filename %>" 
        alt="Product Main Image" 
        id="main-image" 
        class="main-image"
      >

      <% if (product.productImages.length > 1) { %>
        <div class="thumbnail-images">
          <% product.productImages.forEach(image => { %>
            <img 
              src="/uploads/products/<%= image.filename %>" 
              alt="Thumbnail" 
              class="thumbnail"
            >
          <% }) %>
        </div>
      <% } %>
    <% } else { %>
      <img src="/images/no-image.png" alt="No image available">
    <% } %>
  </div>

  <!-- RIGHT COLUMN -->
  <div class="product-info">
    <h1><%= product.productName %></h1>
    <div class="rating">★★★★★ 4.8 (245 Reviews)</div>

    <div class="price-section">
      <p class="current-price">₹<%= Math.round(0.92 * product.price) %></p>
      <p class="original-price">₹<%= product.price %></p>
      <p class="discount">Save 8%</p>
    </div>

    <div class="option-group">
      <label>Quantity:</label>
      <button class="qty-btn" id="decrease">-</button>
      <input type="number" value="1" min="1" id="quantity" readonly>
      <button class="qty-btn" id="increase">+</button>

      <div class="action-buttons">
        <button class="btn-cart">Add to Cart</button>
        <button class="btn-buy" onclick="location.href='/checkout'">Buy Now </button>
      </div>
    </div>
  </div>

</div>


        <!-- Product Description -->
        <section class="product-description">
            <h2>Product Information</h2>
            <p><%= product.productDetails %></p>
        </section>

        <!-- Reviews -->
        <section class="reviews-section">
            <h2>Customer Reviews</h2>
            
            <!-- Review Summary -->
           <%
            let totalRating = 0;
            let totalReviews = reviews.length;

            reviews.forEach(r => {
                totalRating += r.rating;
            });

            let avgRating = totalReviews
                ? (totalRating / totalReviews).toFixed(1)
                : 0;
            %>

            <div class="review-summary">
            <h3><%= avgRating %> out of 5</h3>

            <p class="stars">
                <% for(let i = 1; i <= 5; i++) { %>
                <% if(i <= Math.round(avgRating)) { %>
                    ★
                <% } else { %>
                    ☆
                <% } %>
                <% } %>
            </p>

            <p>Based on <%= totalReviews %> reviews</p>
            </div>


            <!-- Individual Reviews -->
            <div class="reviews-list">
                <% if(reviews){ %>
                    <% reviews.forEach(review =>{ %>
                    <div class="review-card">
                        <strong><%= review.userId.name %></strong>
                        <span class="review-date"> <%= new Date(review.createdAt).toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                            }) %>
                        </span>
                        <p class="stars">
                        <% for(let i = 1; i <= 5; i++) { %>
                            <% if(i <= review.rating) { %>
                            ★
                            <% } else { %>
                            ☆
                            <% } %>
                        <% } %>
                        </p>
                        <p><%= review.review %></p>
                    </div>
                    <% }) %>
                <% }else{ }%>

               
            </div>

            <button class="btn-write-review" onclick="location.href='/review/<%= product.productId %>'">Write a Review</button>
        </section>

        <!-- Related Products -->
        
        <section class="related-products">
             <h2>You May Also Like</h2>
             <div class="more-products">
                <% prods.forEach(product=>{ %>
                    <div class="product-card">
                        <img src="/uploads/products/<%= product.productImages[0].filename %>" alt="product">
                        <h4 align="center"><%= product.productName %></h4>
                        <p align="center" class="price">₹<%= product.price %></p>
                        <a href="/product/<%= product.productId %>">
                            <button class="btn-view">View Details</button>
                        </a>
                    </div>
                    <% }) %>
                </div>
            </div>
        </section>
    </section>

    <!-- ================= FOOTER ================= -->
    <footer class="flipkart-footer">
        <div class="footer-container">
            <div class="footer-column">
                <h4>ABOUT</h4>
                <ul>
                    <li><a href="#">Contact Us</a></li>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Careers</a></li>
                    <li><a href="#">Press</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>HELP</h4>
                <ul>
                    <li><a href="#">Payments</a></li>
                    <li><a href="#">Shipping</a></li>
                    <li><a href="#">Returns</a></li>
                    <li><a href="#">FAQ</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>POLICY</h4>
                <ul>
                    <li><a href="#">Return Policy</a></li>
                    <li><a href="#">Terms Of Use</a></li>
                    <li><a href="#">Security</a></li>
                    <li><a href="#">Privacy</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>SOCIAL</h4>
                <ul>
                    <li><a href="#">Facebook</a></li>
                    <li><a href="#">Twitter</a></li>
                    <li><a href="#">YouTube</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© 2026 E-Commerce Platform</p>
        </div>
    </footer>

    <!-- Link to JavaScript -->
    <script src="../js/product.js"></script>
</body>
</html>